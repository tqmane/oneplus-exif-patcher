# Hasselbladé€ã‹ã—æ©Ÿèƒ½ã®è©³ç´°èª¿æŸ»çµæœ

## ğŸ“‹ æ¦‚è¦

OnePlus Galleryã®Hasselbladé€ã‹ã—æ©Ÿèƒ½ã‚’è©³ç´°ã«èª¿æŸ»ã—ã€ä»¥ä¸‹ã®é‡è¦ãªæƒ…å ±ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚

## ğŸ¯ é‡è¦ãªç™ºè¦‹

### 1. é€ã‹ã—ç”»åƒãƒªã‚½ãƒ¼ã‚¹

ä»¥ä¸‹ã®4ã¤ã®Hasselbladãƒ­ã‚´ç”»åƒãƒªã‚½ãƒ¼ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **hasselblad_watermark_dark** - ãƒ¡ã‚¤ãƒ³ã®Hasselbladãƒ­ã‚´(ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰)
2. **hassel_watermark_h_logo_dark** - Hãƒ­ã‚´(ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰)  
3. **hassel_watermark_h_logo_text_style** - Hãƒ­ã‚´(ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ç”¨)
4. **hasselblad_watermark_text_style** - Hasselbladãƒ­ã‚´(ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ç”¨)

**å•é¡Œ**: ã“ã‚Œã‚‰ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¯APKå†…ã§é›£èª­åŒ–ã•ã‚Œã¦ãŠã‚Šã€ãƒªã‚½ãƒ¼ã‚¹åã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒå¿…è¦ã§ã™ã€‚

### 2. é€ã‹ã—ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«

`/assets/watermark_master_styles/` ã«ä»¥ä¸‹ã®8ã¤ã®Hasselbladã‚¹ã‚¿ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ï¼š

#### é™æ­¢ç”»ç”¨ã‚¹ã‚¿ã‚¤ãƒ«
- `hassel_style_1.json` (7,265 bytes)
- `hassel_style_2.json` (3,820 bytes)
- `hassel_style_3.json` (4,031 bytes)
- `hassel_style_4.json` (18,244 bytes)
- `hassel_text_style_1.json` (27,546 bytes)
- `hassel_text_style_2.json` (10,331 bytes)

#### å‹•ç”»ç”¨ã‚¹ã‚¿ã‚¤ãƒ«
- `video_hassel_text_style_1.json` (27,604 bytes)
- `video_hassel_text_style_2.json` (10,337 bytes)

### 3. ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

`/data/data/com.oneplus.gallery/files/watermark_master/materia/` ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚©ãƒ³ãƒˆï¼š

- **AvenirNext.ttc** (4,994,280 bytes) - ãƒ¡ã‚¤ãƒ³ãƒ•ã‚©ãƒ³ãƒˆ
- **ButlerBold.otf** (43,024 bytes) - å¤ªå­—ãƒ•ã‚©ãƒ³ãƒˆ
- **ButlerMedium.otf** (45,516 bytes) - ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ•ã‚©ãƒ³ãƒˆ
- **FZCYSK.TTF** (10,517,788 bytes) - ä¸­å›½èªãƒ•ã‚©ãƒ³ãƒˆ

**ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚½ãƒ¼ã‚¹**: 
```
https://videoclipfsg.coloros.com/dirfile/icon/2024/11/06/d0f56219-1be1-41b5-84ca-847857d8bff3.zip
MD5: 33ca1145fa326691413fa356abb82753
```

### 4. ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

**liblocal_ai_master_watermark_drawer.so** (322,768 bytes)
- é€ã‹ã—ã®æç”»å‡¦ç†ã‚’è¡Œã†ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- å ´æ‰€: `/lib/arm64-v8a/`

### 5. Javaå®Ÿè£…ã‚¯ãƒ©ã‚¹

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰åˆ¤æ˜ï¼š
```
com.oplus.tbluniformeditor.plugins.watermark.function.WatermarkAlgoImpl
```

## ğŸ“ é€ã‹ã—ã®æ§‹é€ è§£æ

### hassel_style_1ã®æ§‹é€ 

```json
{
  "styleId": "hassel_style_1",
  "baseImageSize": 360,
  "size": {
    "bottomMargin": 60
  },
  "background": {
    "color": "#FFFFFF"
  },
  "elements": [
    {
      "å·¦å´": {
        "type": "text",
        "textSource": 0,  // ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«å
        "font": "OplusSans",
        "fontSize": 13,
        "fontWeight": 700,
        "color": "#000000"
      }
    },
    {
      "å³å´": {
        "type": "image",
        "bitmap": "hasselblad_watermark_dark",
        "width": 112.8,
        "height": 8.96
      }
    },
    {
      "ã‚«ãƒ¡ãƒ©æƒ…å ±": {
        "type": "text",
        "textSource": 1,  // ç„¦ç‚¹è·é›¢ãªã©ã®ã‚«ãƒ¡ãƒ©æƒ…å ±
        "fontSize": 7.2,
        "alpha": 0.7,
        "decorationCircle": {
          "diameter": 7.2,
          "color": "#FF8933"  // OnePlusã®ã‚ªãƒ¬ãƒ³ã‚¸
        }
      }
    }
  ]
}
```

### textSourceã®ç¨®é¡

- **textSource: 0** = ãƒ‡ãƒã‚¤ã‚¹ãƒ¢ãƒ‡ãƒ«å (ä¾‹: "OnePlus 12")
- **textSource: 1** = ã‚«ãƒ¡ãƒ©æƒ…å ± (ä¾‹: "24mm f/1.8 1/100s ISO 100")

## ğŸ¨ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: æ¨ªä¸¦ã³é…ç½® (hassel_style_1, 2)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚  [ãƒ‡ãƒã‚¤ã‚¹å]      [Hasselbladãƒ­ã‚´]â”‚
â”‚                    [â—] [ã‚«ãƒ¡ãƒ©æƒ…å ±]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ä¸­å¤®é…ç½® (hassel_text_style_1)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚              [Hãƒ­ã‚´]               â”‚
â”‚           [ãƒ‡ãƒã‚¤ã‚¹å]             â”‚
â”‚          [ã‚«ãƒ¡ãƒ©æƒ…å ±]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€è¡“çš„ãªå®Ÿè£…è©³ç´°

### JSONã‚¹ã‚­ãƒ¼ãƒã®ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | èª¬æ˜ |
|----------|------|
| `styleId` | ã‚¹ã‚¿ã‚¤ãƒ«ã®ä¸€æ„è­˜åˆ¥å­ |
| `baseImageSize` | åŸºæº–ç”»åƒã‚µã‚¤ã‚º (360px) |
| `size.bottomMargin` | ä¸‹éƒ¨ãƒãƒ¼ã‚¸ãƒ³ |
| `background.color` | èƒŒæ™¯è‰² |
| `bitmaps[].direction` | é…ç½®æ–¹å‘ (3=æ°´å¹³å³å¯„ã›, 4=ä¸­å¤®) |
| `elements[].content.type` | è¦ç´ ã‚¿ã‚¤ãƒ— (text/image/shape/space) |
| `elements[].position.layoutGravity` | é…ç½®ä½ç½® |
| `paint.fontType` | ãƒ•ã‚©ãƒ³ãƒˆã‚¿ã‚¤ãƒ— (0=ã‚·ã‚¹ãƒ†ãƒ , 2=ã‚«ã‚¹ã‚¿ãƒ ) |
| `paint.fontFileType` | ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ— (0=ZIP, 1=TTF) |
| `paint.ttcIndex` | TTCãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ•ã‚©ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |

### ãƒ•ã‚©ãƒ³ãƒˆæŒ‡å®šæ–¹æ³•

```json
{
  "fontType": 2,
  "fontName": "AvenirNext.zip",
  "fontFileType": 0,
  "ttcIndex": 5,
  "font": "https://...",
  "md5": "33ca1145fa326691413fa356abb82753"
}
```

## ğŸ’¡ ã‚¢ãƒ—ãƒªã¸ã®çµ±åˆæ–¹æ³•

### å¿…è¦ãªã‚¹ãƒ†ãƒƒãƒ—

#### 1. ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã®å–å¾—
APKã‚’decompileã—ã¦ã€ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æŠ½å‡ºï¼š
- `hasselblad_watermark_dark`
- `hassel_watermark_h_logo_dark`
- `hassel_watermark_h_logo_text_style`
- `hasselblad_watermark_text_style`

**æ–¹æ³•**:
1. APKTool ã¾ãŸã¯ JADX-GUIã‚’ä½¿ç”¨
2. ãƒªã‚½ãƒ¼ã‚¹IDã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
3. `res/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼

#### 2. ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—
ã™ã§ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼š
```
photo/1_data_data_extracted/files/watermark_master/materia/
- AvenirNext.ttc
- ButlerBold.otf
- ButlerMedium.otf
```

#### 3. JSONã‚¹ã‚¿ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ
æ—¢ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ï¼š
```
photo/gallery_extracted/assets/watermark_master_styles/
- hassel_style_1.json
- hassel_style_2.json
- hassel_text_style_1.json
ç­‰
```

#### 4. æç”»ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è§£æã™ã‚‹ã‹ã€JSONã‚’åŸºã«ç‹¬è‡ªå®Ÿè£…ï¼š

```kotlin
// ä¾‹: JSONãƒ‘ãƒ¼ã‚µãƒ¼
data class WatermarkStyle(
    val styleId: String,
    val baseImageSize: Int,
    val size: Size,
    val background: Background,
    val bitmaps: List<BitmapElement>
)

// æç”»ã‚¨ãƒ³ã‚¸ãƒ³
class WatermarkRenderer {
    fun renderWatermark(
        sourceImage: Bitmap,
        style: WatermarkStyle,
        deviceModel: String,
        cameraInfo: String
    ): Bitmap {
        // 1. ã‚­ãƒ£ãƒ³ãƒã‚¹ä½œæˆ
        // 2. ã‚¹ã‚¿ã‚¤ãƒ«ã«åŸºã¥ã„ã¦è¦ç´ ã‚’é…ç½®
        // 3. ãƒ†ã‚­ã‚¹ãƒˆã‚½ãƒ¼ã‚¹ã‚’ç½®æ›
        // 4. åˆæˆ
    }
}
```

## ğŸš€ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å„ªå…ˆåº¦: é«˜
1. **APKã‚’decompile**ã—ã¦ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã‚’æŠ½å‡º
   - ãƒ„ãƒ¼ãƒ«: JADX-GUI ã¾ãŸã¯ APKTool
   - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: `hasselblad_watermark_dark` ãªã©ã®ç”»åƒ

2. **ãƒªã‚½ãƒ¼ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ã®ä½œæˆ**
   - `resources.arsc` ã‚’è§£æ
   - ãƒªã‚½ãƒ¼ã‚¹ID â†’ ãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒãƒƒãƒ”ãƒ³ã‚°

### å„ªå…ˆåº¦: ä¸­
3. **é€ã‹ã—æç”»ã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…**
   - Kotlin/Javaã§å®Ÿè£…
   - Canvas APIã‚’ä½¿ç”¨
   - JSONãƒ‘ãƒ¼ã‚µãƒ¼ã¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼

4. **ãƒ•ã‚©ãƒ³ãƒˆã®çµ±åˆ**
   - AvenirNext.ttcã‚’assetsã«è¿½åŠ 
   - Typefaceã¨ã—ã¦èª­ã¿è¾¼ã¿

### å„ªå…ˆåº¦: ä½
5. **ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è§£æ**(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
   - Ghidra ã¾ãŸã¯ IDA Proã§è§£æ
   - ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç†è§£

## ğŸ“ å®Ÿè£…ä¾‹ï¼ˆç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰

```kotlin
class HasselbladWatermarkRenderer(context: Context) {
    private val styles = loadStyles()
    private val fonts = loadFonts()
    private val logos = loadLogos()
    
    fun addWatermark(
        image: Bitmap,
        styleId: String,
        exifData: ExifInterface
    ): Bitmap {
        val style = styles[styleId] ?: return image
        val deviceModel = Build.MODEL
        val cameraInfo = extractCameraInfo(exifData)
        
        val canvas = Canvas(image)
        
        // ã‚¹ã‚¿ã‚¤ãƒ«ã«åŸºã¥ã„ã¦æç”»
        style.bitmaps.forEach { bitmap ->
            bitmap.elements.forEach { element ->
                when (element.content.type) {
                    "text" -> drawText(canvas, element, deviceModel, cameraInfo)
                    "image" -> drawImage(canvas, element)
                    "shape" -> drawShape(canvas, element)
                }
            }
        }
        
        return image
    }
    
    private fun extractCameraInfo(exif: ExifInterface): String {
        val focalLength = exif.getAttribute(ExifInterface.TAG_FOCAL_LENGTH)
        val aperture = exif.getAttribute(ExifInterface.TAG_F_NUMBER)
        val iso = exif.getAttribute(ExifInterface.TAG_ISO_SPEED_RATINGS)
        val exposureTime = exif.getAttribute(ExifInterface.TAG_EXPOSURE_TIME)
        
        return "$focalLength f/$aperture $exposureTime ISO $iso"
    }
}
```

## âš ï¸ æ³¨æ„äº‹é …

### æ³•çš„è€ƒæ…®
- Hasselbladã®ãƒ­ã‚´ã¨å•†æ¨™ã¯ Hasselblad AB ã®æ‰€æœ‰ç‰©
- å•†ç”¨åˆ©ç”¨ã«ã¯è¨±å¯ãŒå¿…è¦ãªå¯èƒ½æ€§
- å€‹äººä½¿ç”¨/æ•™è‚²ç›®çš„ã§ã®å®Ÿè£…ã‚’æ¨å¥¨

### æŠ€è¡“çš„åˆ¶é™
- ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Œå…¨ãªå†ç¾ã¯å›°é›£
- OpenGLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ä½¿ç”¨ã‚‚æ¤œè¨
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒå¿…è¦

## ğŸ” ã•ã‚‰ãªã‚‹èª¿æŸ»ãŒå¿…è¦ãªé …ç›®

1. âœ… ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã®æŠ½å‡ºæ–¹æ³•
2. âœ… ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ
3. âš ï¸ ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è©³ç´°ãªå‹•ä½œ
4. âš ï¸ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ä½¿ç”¨æ–¹æ³•
5. âš ï¸ HDRç”»åƒã¸ã®å¯¾å¿œ

## ğŸ“š å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«

- `photo/gallery_extracted/assets/watermark_master_styles/` - ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
- `photo/1_data_data_extracted/files/watermark_master/materia/` - ãƒ•ã‚©ãƒ³ãƒˆ
- `photo/gallery_extracted/lib/arm64-v8a/liblocal_ai_master_watermark_drawer.so` - ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- `photo/gallery_extracted/assets/tbluniformeditor/plugin/plugin_watermark_config.xml` - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

## çµè«–

Hasselbladé€ã‹ã—æ©Ÿèƒ½ã¯**å®Ÿè£…å¯èƒ½**ã§ã™ï¼

ä¸»ãªè¦ç´ ï¼š
1. âœ… JSONã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© - åˆ©ç”¨å¯èƒ½
2. âœ… ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ« - æŠ½å‡ºæ¸ˆã¿
3. âš ï¸ ãƒ­ã‚´ç”»åƒ - decompileã§æŠ½å‡ºå¯èƒ½
4. âš ï¸ æç”»ã‚¨ãƒ³ã‚¸ãƒ³ - ç‹¬è‡ªå®Ÿè£…ãŒå¿…è¦

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã—ã¦ã€APKã‚’JADX-GUIã§decompileã—ã€ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
